<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grapesjs Rulers</title>
    <!--<script src="https://unpkg.com/grapesjs"></script>
    <link rel="stylesheet" href="https://unpkg.com/grapesjs/dist/css/grapes.min.css">
    <script src="https://unpkg.com/ruler.js/dist/ruler.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/ruler/dist/ruler.min.css">-->
    <script src="../offline/grapes.min.js"></script>
    <link rel="stylesheet" href="../offline/css/grapes.min.css">
    <script src="./ruler.js"></script>
    <link rel="stylesheet" href="./ruler.css">
    <style>
        body,
        html {
            margin: 0;
            height: 100%;
        }
    </style>
</head>

<body>
    <div id="gjs">
        <div class="panel">
            <h1 class="welcome">Welcome to</h1>
            <div class="big-title">
                <svg class="logo" viewBox="0 0 100 100">
                    <path
                        d="M40 5l-12.9 7.4 -12.9 7.4c-1.4 0.8-2.7 2.3-3.7 3.9 -0.9 1.6-1.5 3.5-1.5 5.1v14.9 14.9c0 1.7 0.6 3.5 1.5 5.1 0.9 1.6 2.2 3.1 3.7 3.9l12.9 7.4 12.9 7.4c1.4 0.8 3.3 1.2 5.2 1.2 1.9 0 3.8-0.4 5.2-1.2l12.9-7.4 12.9-7.4c1.4-0.8 2.7-2.2 3.7-3.9 0.9-1.6 1.5-3.5 1.5-5.1v-14.9 -12.7c0-4.6-3.8-6-6.8-4.2l-28 16.2" />
                </svg>
                <span>GrapesJS</span>
            </div>
            <div class="description">
                This is a demo content from index.html. For the development, you shouldn't edit this file, instead you
                can
                copy and rename it to _index.html, on next server start the new file will be served, and it will be
                ignored by
                git.
            </div>
        </div>
        <style>
            .panel {
                width: 90%;
                max-width: 700px;
                border-radius: 3px;
                padding: 30px 20px;
                margin: 150px auto 0px;
                background-color: #d983a6;
                box-shadow: 0px 3px 10px 0px rgba(0, 0, 0, 0.25);
                color: rgba(255, 255, 255, 0.75);
                font: caption;
                font-weight: 100;
            }

            .welcome {
                text-align: center;
                font-weight: 100;
                margin: 0px;
            }

            .logo {
                width: 70px;
                height: 70px;
                vertical-align: middle;
            }

            .logo path {
                pointer-events: none;
                fill: none;
                stroke-linecap: round;
                stroke-width: 7;
                stroke: #fff
            }

            .big-title {
                text-align: center;
                font-size: 3.5rem;
                margin: 15px 0;
            }

            .description {
                text-align: justify;
                font-size: 1rem;
                line-height: 1.5rem;
            }
        </style>
    </div>
    <script>
        const editor = grapesjs.init({
            container: '#gjs',
            height: '100%',
            fromElement: true,
            storageManager: false,
            dragMode: 'translate'
        });

        editor.on('load', () => {
            const pn = editor.Panels;
            const $ = editor.$;
            const pfx = editor.Config.stylePrefix;
            const openSm = pn.getButton('views', 'open-sm');
            openSm && openSm.set('active', 1);

            // Add Canvas Settings Sector
            const canvasSector = $(`<div class="${pfx}sm-sector no-select">
                <div class="${pfx}sm-title"><span class="icon-settings fa fa-object-group"></span> Canvas</div>
                <div class="${pfx}sm-properties" style="display: none;"></div></div>`);
            const canvasProps = canvasSector.find(`.${pfx}sm-properties`);
            const canvasInputs = $(`<div id="gjs-sm-font-size" class="gjs-sm-property gjs-sm-slider gjs-sm-property__zoom" style="display: block;">
            <div class="gjs-sm-label" data-sm-label="">
            <span class="gjs-sm-icon " title="">
                Zoom
            </span>
            <b class="gjs-sm-clear" data-clear-style="" style="display: none;">тип</b>
            </div>
            <div class="gjs-fields" data-sm-fields="">
            <div class="gjs-field gjs-field-range">
                <input type="range" min="0" max="100" step="1">
            </div>
            <div class="gjs-field gjs-field-integer">
            <span class="gjs-input-holder"><input type="text" placeholder="medium"></span>
            <span class="gjs-field-units"><select class="gjs-input-unit"><option>%</option></select></span>
            <div class="gjs-field-arrows" data-arrows="">
                <div class="gjs-field-arrow-u" data-arrow-up=""></div>
                <div class="gjs-field-arrow-d" data-arrow-down=""></div>
            </div>
            </div></div>
            </div>

            <div id="gjs-sm-top" class="gjs-sm-property gjs-sm-integer gjs-sm-property__top" style="display: block;">
            <div class="gjs-sm-label">
                
            <span class="gjs-sm-icon " title="">
                Top
            </span>
            <b class="gjs-sm-clear" data-clear-style="" style="display: none;">тип</b>
            
            </div>
            <div class="gjs-fields">
                
            <div class="gjs-field gjs-field-integer">
            <span class="gjs-input-holder"><input type="text" placeholder="auto"></span>
            <span class="gjs-field-units"><select class="gjs-input-unit"><option selected="">px</option><option>%</option><option>vh</option></select></span>
            <div class="gjs-field-arrows" data-arrows="">
                <div class="gjs-field-arrow-u" data-arrow-up=""></div>
                <div class="gjs-field-arrow-d" data-arrow-down=""></div>
            </div>
            </div></div>
            </div>

            <div id="gjs-sm-top" class="gjs-sm-property gjs-sm-integer gjs-sm-property__top" style="display: block;">
            <div class="gjs-sm-label">
                
            <span class="gjs-sm-icon " title="">
                Left
            </span>
            <b class="gjs-sm-clear" data-clear-style="" style="display: none;">тип</b>
            
            </div>
            <div class="gjs-fields">
                
            <div class="gjs-field gjs-field-integer">
            <span class="gjs-input-holder"><input type="text" placeholder="auto"></span>
            <span class="gjs-field-units"><select class="gjs-input-unit"><option selected="">px</option><option>%</option><option>vh</option></select></span>
            <div class="gjs-field-arrows" data-arrows="">
                <div class="gjs-field-arrow-u" data-arrow-up=""></div>
                <div class="gjs-field-arrow-d" data-arrow-down=""></div>
            </div>
            </div></div>
            </div>

            <div class="gjs-trt-trait__wrp"><div class="gjs-trt-trait gjs-trt-trait--checkbox">
            <div class="gjs-label-wrp" data-label=""><div class="gjs-label" title="Rulers">Rulers</div></div>
            <div class="gjs-field-wrp gjs-field-wrp--checkbox" data-input="">
                <label class="gjs-field gjs-field-checkbox" data-input=""><input type="checkbox" placeholder="" value="">
            <i class="gjs-chk-icon"></i>
            </label>
            </div>
            </div></div>
            
            <div class="gjs-trt-trait__wrp"><div class="gjs-trt-trait gjs-trt-trait--checkbox">
            <div class="gjs-label-wrp" data-label=""><div class="gjs-label" title="Guides">Guides</div></div>
            <div class="gjs-field-wrp gjs-field-wrp--checkbox" data-input="">
                <label class="gjs-field gjs-field-checkbox" data-input=""><input type="checkbox" placeholder="" value="">
            <i class="gjs-chk-icon"></i>
            </label>
            </div>
            </div></div>
            
            <div class="gjs-trt-trait__wrp"><div class="gjs-trt-trait gjs-trt-trait--checkbox">
            <div class="gjs-field-wrp gjs-field-wrp--checkbox" data-input="">
                <button class="gjs-btn-prim">Clear Guides</button>
            </div>
            </div></div>`);
            canvasProps.append(canvasInputs);
            $(`.${pfx}sm-sectors`).before(canvasSector);
            canvasSector.find(`.${pfx}sm-title`).on('click', function () {
                let canvasStyle = canvasProps.get(0).style;
                let hidden = canvasStyle.display == 'none';
                if (hidden) {
                    canvasStyle.display = 'block';
                } else {
                    canvasStyle.display = 'none';
                }
            });

            const rulH = 15;
            const rulers = new ruler({
                container: editor.Canvas.getCanvasView().el,
                rulerHeight: rulH,
                strokeStyle: 'white',
                fillStyle: 'white'
            });
            editor.Canvas.setZoom(90);
            const {
                top,
                left
            } = editor.Canvas.getOffset();
            const scale = 10 / 9;
            rulers.api.setPos({
                x: left - rulH,
                y: top - rulH
            });
            rulers.api.setScale(scale);
            editor.on('canvasScroll frame:scroll', () => {
                //change:canvasOffset in future allow canvas positioning ad scaling
                const y = top - rulH - (editor.Canvas.getBody().scrollTop / scale);
                rulers.api.setPos({
                    y
                });
            })
        });
    </script>
</body>

</html>